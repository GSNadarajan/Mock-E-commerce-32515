{"is_source_file": true, "format": "JavaScript", "description": "Middleware functions for authentication and authorization in an Express application, including JWT token validation and user role checks.", "external_files": ["../config/auth", "../services/userService", "../utils/logger"], "external_methods": ["userService.verifyToken", "userService.validateUser", "userService.isAdmin"], "published": ["authenticateToken", "userExists", "isAdmin", "isResourceOwner"], "classes": [], "methods": [{"name": "errorResponse", "description": "Helper function to format an error response for Express."}, {"name": "authenticateToken", "description": "Middleware to authenticate JWT tokens in incoming requests."}, {"name": "userExists", "description": "Middleware to check if a user exists based on the provided user ID."}, {"name": "isAdmin", "description": "Middleware to check if the authenticated user has admin privileges."}, {"name": "isResourceOwner", "description": "Middleware to check if the authenticated user is the owner of a specified resource."}], "calls": ["jwt.verify", "userService.verifyToken", "userService.validateUser", "userService.isAdmin"], "search-terms": ["JWT authentication", "user authorization", "Express middleware"], "state": 2, "file_id": 42, "knowledge_revision": 172, "git_revision": "ca5dd1bf6845b8636ab91d03061ec68fd0bcd444", "revision_history": [{"91": ""}, {"114": "afef8557091f4665925a3c7c75720cebc364fbe9"}, {"154": "69a514964ce5aea190e7c2b6ed9c87ef2f95e4a8"}, {"172": "ca5dd1bf6845b8636ab91d03061ec68fd0bcd444"}], "ctags": [{"_type": "tag", "name": "Logger", "path": "/home/kavia/workspace/Mock-E-commerce-32515/order-management/src/middleware/auth.js", "pattern": "/^const Logger = require('..\\/utils\\/logger');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "authConfig", "path": "/home/kavia/workspace/Mock-E-commerce-32515/order-management/src/middleware/auth.js", "pattern": "/^const authConfig = require('..\\/config\\/auth');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "authHeader", "path": "/home/kavia/workspace/Mock-E-commerce-32515/order-management/src/middleware/auth.js", "pattern": "/^    const authHeader = req.headers['authorization'];$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "authHeader", "path": "/home/kavia/workspace/Mock-E-commerce-32515/order-management/src/middleware/auth.js", "pattern": "/^  const authHeader = req.headers['authorization'];$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "authenticateToken", "path": "/home/kavia/workspace/Mock-E-commerce-32515/order-management/src/middleware/auth.js", "pattern": "/^  authenticateToken,$/", "language": "JavaScript", "kind": "field", "scope": "module.exports", "scopeKind": "class"}, {"_type": "tag", "name": "authenticateToken", "path": "/home/kavia/workspace/Mock-E-commerce-32515/order-management/src/middleware/auth.js", "pattern": "/^const authenticateToken = async (req, res, next) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "decoded", "path": "/home/kavia/workspace/Mock-E-commerce-32515/order-management/src/middleware/auth.js", "pattern": "/^    let decoded;$/", "language": "JavaScript", "kind": "variable"}, {"_type": "tag", "name": "errorResponse", "path": "/home/kavia/workspace/Mock-E-commerce-32515/order-management/src/middleware/auth.js", "pattern": "/^const errorResponse = (res, statusCode, message, errorCode) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "isAdmin", "path": "/home/kavia/workspace/Mock-E-commerce-32515/order-management/src/middleware/auth.js", "pattern": "/^const isAdmin = async (req, res, next) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "isResourceOwner", "path": "/home/kavia/workspace/Mock-E-commerce-32515/order-management/src/middleware/auth.js", "pattern": "/^const isResourceOwner = async (req, res, next) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "isUserAdmin", "path": "/home/kavia/workspace/Mock-E-commerce-32515/order-management/src/middleware/auth.js", "pattern": "/^      const isUserAdmin = await userService.isAdmin(req.user.id, token);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "jwt", "path": "/home/kavia/workspace/Mock-E-commerce-32515/order-management/src/middleware/auth.js", "pattern": "/^const jwt = require('jsonwebtoken');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "resourceUserId", "path": "/home/kavia/workspace/Mock-E-commerce-32515/order-management/src/middleware/auth.js", "pattern": "/^  const resourceUserId = req.params.userId || req.body.userId;$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "token", "path": "/home/kavia/workspace/Mock-E-commerce-32515/order-management/src/middleware/auth.js", "pattern": "/^    const token = authHeader && authHeader.split(' ')[1];$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "token", "path": "/home/kavia/workspace/Mock-E-commerce-32515/order-management/src/middleware/auth.js", "pattern": "/^  const token = authHeader && authHeader.split(' ')[1];$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "userData", "path": "/home/kavia/workspace/Mock-E-commerce-32515/order-management/src/middleware/auth.js", "pattern": "/^      const userData = await userService.verifyToken(token);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "userExists", "path": "/home/kavia/workspace/Mock-E-commerce-32515/order-management/src/middleware/auth.js", "pattern": "/^      const userExists = await userService.validateUser(userId, token);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "userExists", "path": "/home/kavia/workspace/Mock-E-commerce-32515/order-management/src/middleware/auth.js", "pattern": "/^const userExists = async (req, res, next) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "userId", "path": "/home/kavia/workspace/Mock-E-commerce-32515/order-management/src/middleware/auth.js", "pattern": "/^    const userId = req.params.userId || req.body.userId || (req.user && req.user.id);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "userService", "path": "/home/kavia/workspace/Mock-E-commerce-32515/order-management/src/middleware/auth.js", "pattern": "/^const userService = require('..\\/services\\/userService');$/", "language": "JavaScript", "kind": "constant"}], "filename": "/home/kavia/workspace/Mock-E-commerce-32515/order-management/src/middleware/auth.js", "hash": "14c604280c88fea992ad438718ccd087", "format-version": 4, "code-base-name": "default", "fields": [{"name": "authenticateToken,", "scope": "module.exports", "scopeKind": "class", "description": "unavailable"}, {"name": "let decoded;", "scope": "", "scopeKind": "", "description": "unavailable"}]}